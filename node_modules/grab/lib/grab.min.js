// Copyright (c) 2013 Andrew Luetgers, MIT License
(function(){var root=this,_=root._;if (!_ && "module" in root && module.exports) {root._ = _ = require("underscore");}
	if(!_){throw new Error("grab.js requires underscore.js");}
	var grabReQuo=/"|'/g,grabReOpBr=/\[/g,grabReClBr=/\]/g,emptyStr="",period=".";function _grabStr(obj,path,alt,verbose){path=path.replace(grabReQuo,emptyStr).replace(grabReOpBr,period).replace(grabReClBr,emptyStr).split(period);var val=obj,altVal;_.every(path,function(pathStr,idx){console.log("val at",val,pathStr);val=val[pathStr];if((idx<path.length-1&&!val)||val===undefined||val===""||val===null){altVal=_.isFunction(alt)?alt(obj,path,idx):alt;return false;}else{return true;}});return verbose?{val:val,altVal:altVal}:altVal||val;}
	function _grabObj(obj,path){var res={};_.each(path,function(val,key){if(_.isArray(val)){res[key]=_.grab(obj,val[0],val[1]);}else{res[key]=_.grab(obj,val);}});return res;}
	function _grabArr(obj,path,alt){var val={};_.all(path,function(_path){val=_.grab(obj,_path,alt,true);return!val.val;});console.log("_grabArr",val.val||val.altVal,val);return(val.val||val.val===0||val.val===false)?val.val:val.altVal;}
	_.grab=function(obj,path,alt,verbose){if(!obj){return alt;}
		if(typeof path==="string"){return _grabStr(obj,path,alt,verbose);}else if(_.isArray(path)){return _grabArr(obj,path,alt,verbose);}else if(_.isObject(path)){return _grabObj(obj,path);}
		return alt;}
	if("module"in root){module.exports={grab:_.grab,_:_};}}());